#!/bin/sh

set -x
# This script uses the tools we just build to convert Truetype fonts into
# the format used by Ming.

setname=$1
dstname=$setname
if [ "$2" != "" ]
then
	dstname=$2
fi

mkdir -p fonts/$dstname
mkdir -p fonts/$dstname/fft
mkdir -p fonts/$dstname/fdb

topdir=`pwd`
export PERL5LIB=$topdir/perl_ext/blib/lib:$topdir/perl_ext/blib/arch/

for font in /usr/share/fonts/truetype/$setname/*.ttf
do
	fname=`basename $font .ttf`
	cd $topdir/fonts/$dstname/fft
	LD_LIBRARY_PATH=$topdir/src/.libs perl $topdir/debian/ttftofft.pl $setname $fname
	cd $topdir/fonts/$dstname/fdb
	LD_LIBRARY_PATH=$topdir/src/.libs $topdir/util/makefdb $topdir/fonts/$dstname/fft/$fname.fft
	rm -f $topdir/fonts/$dstname/fft/$fname.fft
	mv $topdir/fonts/$dstname/fdb/font2.fdb $topdir/fonts/$dstname/fdb/$fname.fdb
done
